<%= simple_nested_form_for(pacient, :html => { :class => 'form-horizontal' }) do |f| %>
  <fieldset>
    <%= f.simple_fields_for :record do |rec_form| %>
      <%= rec_form.input :status, :include_blank => "Selecione um status" %> 
      <div class="controls" id="last_appointment">
        <%= text_field_tag :last_appointment_date, (pacient.record.last_appointment ? l(pacient.record.last_appointment.scheduled_at) : nil), :placeholder => "Data da última consulta", :class => 'datepicker', 'data-date'=> pacient.record.last_appointment.try(:scheduled_at), 'data-date-format'=>"dd/mm/yyyy" %>
      </div>
    <% end %>
    <br />
    <%= f.input :name, :input_html => {:class => 'input-large'} %>
    <%= f.input :birthdate, :as => :string, :input_html => {:class => 'datepicker', 'data-date'=> pacient.birthdate, 'data-date-format'=>"dd/mm/yyyy"} %>

    <!-- caso overage? -->
    <%= f.input :cpf %>
    <%= f.input :rg %>

    <!-- caso !overage? -->
    <%= f.input :parent_name %>
    <%= f.input :parent_rg %>
    <%= f.input :parent_cpf %>

    <%= f.association :health_insurance, :include_blank => 'Selecione uma opção' %>
    <%= f.input :address, :input_html => {:class => 'input-large'} %>
    <%= f.input :phone %>
    <%= f.input :email %>

    <%= f.simple_fields_for :contact_infos do |cinfos_form| %>
      <%= cinfos_form.input :type, :collection => ContactInfo.contact_types , :label => false, :default => false %>
      <%= cinfos_form.input :value, :label => false %>
      <%= cinfos_form.link_to_remove "Remover contato" %>
    <% end %>
    <%= f.link_to_add "Adicionar contato", :contact_infos %>

    <div class="form-actions">
      <%= f.button :submit, "Cadastrar" %>
      <%= link_to "Cancelar", pacients_path, :class => :btn %>
    </div>
  </fieldset>
<% end %>


<script>
  $( function() {  
    $('#pacient_birthdate').datepicker('remove');
    $('#pacient_birthdate').datepicker({
      startView: 'year',
      language: 'pt-BR',
      endDate: new Date(),
      todayHighlight: true,
      autoclose: true
    });

    $("#pacient_record_attributes_status").on('change', function () {
      if($(this).val()=='new' || $(this).val()=="") {
        $('div#last_appointment').hide();
      }
      else {
        $('div#last_appointment').show();
      }
    });

    $("#pacient_record_attributes_status").trigger('change');
    
  });
</script>